const isInStandaloneMode=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");function ajax(e,t,n,o){if("function"==typeof t)var i=t,a=n||1e4;else{var s=t;i=n,a=o||1e4}new Date;var r=new XMLHttpRequest;if(r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e;try{e=JSON.parse(this.response)}catch(t){e=this.response}i(e),r=null}else 4==this.readyState&&i({error:"failure"})},r.ontimeout=function(e){i({error:"timeout"})},s){if(!(s instanceof FormData)){var c=new FormData;for(var l in s)c.append(l,s[l]);s=c}r.open("POST",e,!0),r.timeout=a,r.send(s)}else r.open("GET",e,!0),r.timeout=a,r.send();return r}function textareaAutosize(){function e(e){var t,n=window.getComputedStyle(e.target,null);t="content-box"===e.target.boxSizing?-(parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)):parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth);var o=e.target.scrollHeight+t+"px";e.target.style.height=o}document.querySelectorAll("textarea.autosize").forEach(t=>{t.hasResizeEvents||(t.addEventListener("change",e),t.addEventListener("keyup",e),t.addEventListener("keydown",e),t.addEventListener("paste",e),t.addEventListener("cut",e),t.hasResizeEvents=!0,t.resize=(()=>t.dispatchEvent(new Event("change"))),t.resize())})}function popup(e,t,n){var o=document.getElementById("popup-reusable");n||(n=[]),o.querySelector(".content h2").innerHTML=e,o.querySelector(".content p").innerHTML=t;var i=o.querySelector(".buttons");i.innerHTML="",Object.keys(n).forEach(function(e,t){var a=document.createElement("button");a.className="link-button",a.innerHTML=e,a.addEventListener("click",function(){if("string"==typeof n[e])return"hide"==n[e]?o.hide():window.location.href=n[e];n[e].call(o)}),i.appendChild(a)}),o.show()}!function(){function e(e){e||(e=this),e.addEventListener("click",function(e){if(e.target.classList.contains("dropdown"))e.target.classList.contains("open")?e.target.classList.contains("open")&&n(e.target):t(e.target);else if(e.target.classList.contains("option")){var o=e.target.innerHTML,i=e.target.closest(".dropdown");i.querySelector('input[type="hidden"]').value=o,n(i)}}),e.openDropdown=t,e.closeDropdown=n,e.getValue=o,e.setValue=i,""!=e.getValue()&&e.setValue()}function t(e){e||(e=this),document.querySelectorAll(".dropdown").forEach(e=>{e.classList.contains("open")&&n(e)}),e.classList.add("open"),e.querySelector(".selection").innerHTML=e.querySelector(".placeholder").innerHTML}function n(e){e||(e=this),e.classList.remove("open");var t=e.querySelector('input[type="hidden"]').value,n=e.querySelector(".placeholder").innerHTML;e.querySelector(".selection").innerHTML=""==t?n:t}function o(){return this.querySelector('input[type="hidden"]').value}function i(e){e||(e=this.getValue());var t=this.querySelectorAll(".options .option"),o=(t=Array.prototype.slice.call(t)).find(t=>t.innerHTML==e);if(o){var i=o.innerHTML;this.querySelector('input[type="hidden"]').value=i,n(this)}else this.querySelector('input[type="hidden"]').value=""}document.addEventListener("click",function(e){e.target.closest(".dropdown")||document.querySelectorAll(".dropdown").forEach(e=>{e.classList.contains("open")&&n(e)})}),HTMLElement.prototype.initDropdown=e,document.querySelectorAll(".dropdown").forEach(t=>e(t))}(),function(){function e(e){e||(e=this),e.classList.contains("checkbox")&&(e.addEventListener("click",function(e){e.target.classList.contains("checkbox")&&!e.target.classList.contains("disabled")&&t(e.target)}),e.toggleCheckbox=t,e.getValue=n,e.setValue=o)}function t(e){e||(e=this),e.classList.contains("checked")?(e.classList.remove("checked"),e.isChecked=!1,e.querySelector('input[type="hidden"]').value=0):(e.classList.add("checked"),e.isChecked=!0,e.querySelector('input[type="hidden"]').value=1)}function n(){return"1"==this.querySelector('input[type="hidden"]').value}function o(e){var t="1"==e||"true"==e||1==e;t?(this.classList.add("checked"),this.isChecked=!0,this.querySelector('input[type="hidden"]').value=1):(this.classList.remove("checked"),this.isChecked=!1,this.querySelector('input[type="hidden"]').value=0)}HTMLElement.prototype.initCheckbox=e,document.querySelectorAll(".checkbox").forEach(t=>e(t))}(),function(){function e(e){e||(e=this),e.classList.contains("textbox")&&(e.getValue=t,e.setValue=n,e.parentElement.querySelector(".edit-warning")&&e.addEventListener("keyup",t=>{e.parentElement.querySelector(".edit-warning").classList.add("visible")}))}function t(){return this.value}function n(e){this.value=e}HTMLElement.prototype.inittextbox=e,document.querySelectorAll(".textbox").forEach(t=>e(t))}(),function(){function e(e){e||(e=this),e.classList.contains("radioblock")&&(e.getValue=t,e.setValue=n)}function t(){var e=this.querySelector('input[type="radio"]:checked');return e?e.value:""}function n(e){var t=this.querySelectorAll('input[type="radio"]'),n=(t=Array.prototype.slice.call(t)).find(t=>t.value==e);n&&(n.checked=!0)}HTMLElement.prototype.initradioblock=e,document.querySelectorAll(".radioblock").forEach(t=>e(t))}(),function(){function e(e){e||(e=this),e.classList.contains("switchbutton")&&(e.addEventListener("click",function(e){e.target.classList.contains("switchbutton")&&t(e.target)}),e.toggleSwitchbutton=t,e.getValue=n,e.setValue=o)}function t(e){e||(e=this);var t="on";e.classList.contains("on")?(e.classList.remove("on"),e.isChecked=!1,e.querySelector('input[type="hidden"]').value=0,t="off"):(e.classList.add("on"),e.isChecked=!0,e.querySelector('input[type="hidden"]').value=1);var n=new Event("change");n.state=t,e.dispatchEvent(n)}function n(){return"1"==this.querySelector('input[type="hidden"]').value}function o(e){var t="on"==e||"1"==e||"true"==e||1==e;t?(this.classList.add("on"),this.isChecked=!0,this.querySelector('input[type="hidden"]').value=1):(this.classList.remove("on"),this.isChecked=!1,this.querySelector('input[type="hidden"]').value=0)}HTMLElement.prototype.initSwitchbutton=e,document.querySelectorAll(".switchbutton").forEach(t=>e(t))}(),function(){function e(e){e||(e=this),e.classList.contains("link-copier")&&(e.container=e.closest(".link-copier-holder"),e.setUrl=n,e.reset=t,e.realLink=e.parentElement.querySelector("a.link-copier-link"),e.addEventListener("click",t=>{t.target.select(),document.execCommand("copy"),e.container.classList.add("copied")}))}function t(e){this.closest(".link-copier-holder").classList.remove("copied")}function n(e){this.value=e,this.realLink&&(this.realLink.href=e)}HTMLElement.prototype.initLinkCopier=e,document.querySelectorAll(".link-copier").forEach(t=>e(t))}(),textareaAutosize(),function(){function e(e){e||(e=this),e.classList.contains("popup")&&(e.addEventListener("click",function(e){e.target.classList.contains("popup")&&e.target.hide(e)}),e.show=function(e){this.classList.add("open"),document.body.classList.add("popupOpen"),this.querySelectorAll("textarea.autosize").forEach(e=>e.resize()),this.querySelectorAll(".file-uploader-holder").forEach(e=>e.enable()),e&&e.preventDefault()}.bind(e),e.hide=function(e){this.classList.remove("open"),document.body.classList.remove("popupOpen"),this.onHide&&this.onHide();this.querySelectorAll(".file-uploader-holder").forEach(e=>e.disable()),this.querySelector(".content").style="",e&&e.preventDefault()}.bind(e))}HTMLElement.prototype.initPopup=e,document.querySelectorAll(".popup").forEach(t=>e(t))}(),function(){var e=document.querySelector(".toast");function t(t,n,o){n?e.querySelector("svg").outerHTML=n:e.querySelector("svg").style.display="none",o?(e.querySelector(".undo").classList.remove("hidden"),e.querySelector(".undo").onclick=function(t){t.preventDefault(),e.classList.remove("shown"),o()}):e.querySelector(".undo").classList.add("hidden"),e.querySelector("p").innerHTML=t,e.classList.add("shown"),setTimeout(()=>{e.classList.remove("shown")},4e3+(o?4e3:0))}e.show=function(e,n,o){n?ajax("/svg/"+n,n=>{n.error?t(e,null,o):t(e,n.html,o)}):t(e,null,o)},e.addEventListener("click",()=>{})}();var installEvent,toast=document.querySelector(".toast");if(!isInStandaloneMode){var mobileMenu={container:document.querySelector("#mobile-menu"),wrapper:document.querySelector("#mobile-menu .wrapper"),button:document.querySelector("header.top .mobile-menu-toggle"),resizeTimer:null,menuOpen:!1,adjustMobileMenu:function(){var e=document.querySelectorAll("#main-menu a"),t=document.querySelector("#main-menu").offsetTop,n=this.wrapper;mobileMenu.button.classList.remove("hidden"),n.innerHTML="";var o=0;Array.from(e).forEach(function(e){if(e.offsetTop-t>20){var i=e.cloneNode(!0);n.appendChild(i),o++}}),0==o?mobileMenu.button.classList.add("hidden"):mobileMenu.button.classList.remove("hidden")}};mobileMenu.adjustMobileMenu(),window.addEventListener("resize",function(e){clearTimeout(mobileMenu.resizeTimer),mobileMenu.resizeTimer=setTimeout(function(){mobileMenu.adjustMobileMenu()},50)}),mobileMenu.toggleMenu=function(){var e=document.getElementById("mobile-menu-button-close-icon"),t=document.getElementById("mobile-menu-button-open-icon");mobileMenu.menuOpen?(mobileMenu.container.style.maxHeight=mobileMenu.container.offsetHeight+"px",mobileMenu.container.style.transition="max-height 500ms, opacity 0.5s",setTimeout(function(){mobileMenu.container.style.maxHeight="0px",t.style.display="inline",e.style.display="none",mobileMenu.menuOpen=!1},10)):(mobileMenu.container.style.transition="max-height 1s ease-in, opacity 0.5s",mobileMenu.container.style.maxHeight="100vh",t.style.display="none",e.style.display="inline",mobileMenu.menuOpen=!0)}}var installAppPopup=document.querySelector(".popup.install-app"),promptHolder=document.querySelector(".prompt-holder");if(document.querySelector(".show-app-info-button").addEventListener("click",e=>{e.preventDefault(),installAppPopup.show(),ga("send","event","showed pwa popup",document.referrer)}),window.addEventListener("beforeinstallprompt",e=>{installEvent=e,promptHolder.classList.add("installable"),installEvent.userChoice.then(e=>{"accepted"===e.outcome&&(ga("send","event","installed pwa",document.referrer),location.reload())})}),document.querySelector(".app-install-button").addEventListener("click",e=>{installEvent.prompt()}),function(){if(document.querySelector(".feedback-container")){var e,t="unspecified",n=document.querySelector(".feedback-container .feedback .add-feedback-comment div svg"),o=document.querySelector(".feedback-container .feedback .add-feedback-comment div div");document.querySelector(".feedback-container .feedback .thumbs-up").addEventListener("click",e=>{i(e.target,"Do you have an additional feedback?")}),document.querySelector(".feedback-container .feedback .thumbs-down").addEventListener("click",e=>{i(e.target,"How can we improve this page?")}),document.querySelector(".feedback-container .feedback .add-feedback-comment button").addEventListener("click",i=>{var a=document.querySelector(".feedback-container .feedback .add-feedback-comment textarea").value;""!=a&&(n.style.display="inline-block",o.display="none",ajax("/feedback",{vote:t,voteId:e,feedback:a},t=>{n.style.display="none",t.success?(e=t.vote,o.innerHTML="Your feedback has been recieved!",o.style.display="inline-block"):(o.innerHTML="There was a problem submitting feedback.",o.style.display="inline-block")}),i.preventDefault())}),document.querySelector(".feedback-container .tip-box .show-more").addEventListener("click",e=>{e.preventDefault(),document.querySelector(".feedback-container .tip-box").classList.add("show-hidden")})}function i(n,o){if(document.querySelectorAll(".feedback-container .feedback .selected").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),n.parentElement.parentElement.querySelector(".add-feedback-comment textarea").placeholder=o,n.parentElement.parentElement.querySelector(".add-feedback-comment").classList.remove("hidden"),n.classList.contains("thumbs-up"))t="up";else{if(!n.classList.contains("thumbs-down"))return;t="down"}var i={vote:t};e&&(i.voteId=e),ajax("/feedback",i,t=>{t.success&&(e=t.vote)})}}(),document.querySelector("#user-bar .link-button.login")){var loginPopup=document.querySelector(".popup.login"),signupPopup=document.querySelector(".popup.sign-up");document.querySelector("#user-bar .link-button.login").addEventListener("click",e=>{loginPopup.show(e)}),document.querySelector("#user-bar .link-button.sign-up").addEventListener("click",e=>{signupPopup.show(e)}),loginPopup.querySelector(".switch-to-signup").addEventListener("click",e=>{loginPopup.hide(e),signupPopup.show(e)}),signupPopup.querySelector(".switch-to-login").addEventListener("click",e=>{loginPopup.show(e),signupPopup.hide(e)}),Array.from(document.querySelectorAll(".open-login-form")).forEach(e=>{e.addEventListener("click",e=>{loginPopup.show(e),e.preventDefault()})}),Array.from(document.querySelectorAll(".open-sign-up-form")).forEach(e=>{e.addEventListener("click",e=>{signupPopup.show(e),e.preventDefault()})})}else updateMode||(document.querySelector("#user-bar .profile-menu .user-button").addEventListener("click",e=>{e.target.parentElement.classList.toggle("open"),e.preventDefault()}),document.querySelector("#user-bar .profile-menu .logout-button").addEventListener("click",e=>{}));if(document.body.addEventListener("devicePixelRatio",e=>{var t=1+window.devicePixelRatio%1;if(1!=t){var n=document.createElement("style");n.innerHTML=`\n\timg.emoji.p12 {width: ${24/t}px}\n\timg.emoji.p16 {width: ${32/t}px}\n\timg.emoji.p24 {width: ${24/t}px}\n\timg.emoji.p32 {width: ${32/t}px}\n\t`,document.head.appendChild(n)}}),function(){var e,t=!1,n=0,o=document.querySelector("#user-bar .notifications"),i=document.querySelector("#user-bar .notifications .unread-number"),a=document.querySelector("#switchbutton-enable-push");if(o){var s=o.querySelector(".notification-list ul"),r=s.querySelector(".end");o.init=function(e){"PushManager"in window&&(a.addEventListener("change",t=>{"on"==t.state?"granted"==Notification.permission?(c(e),ga("send","event","push enabled","already had permission")):"denied"==Notification.permission?(a.setValue("off"),toast.show("Push notifications for Lospec are blocked. Re&#8209;enable it in your browser settings.","warning"),ga("send","event","push blocked","already blocked")):new Promise(function(e,t){const n=Notification.requestPermission(function(t){e(t)});n&&n.then(e,t)}).then(function(e){if("granted"!==e)throw new Error("We weren't granted permission.")}).then(function(t){c(e),ga("send","event","push enabled","user accepted")}).catch(e=>{a.setValue("off"),toast.show("Permission to use push notifications was denied.","warning"),ga("send","event","push blocked","user denied")}):"off"==t.state&&e.pushManager.getSubscription().then(function(e){e.unsubscribe().then(function(e){toast.show("Push notifications have been disabled.","check"),ga("send","event","push disabled","user turned off"),ga("send","event","push notifications disabled")}).catch(function(e){toast.show("Failed to disable push notifications.","warning")})})}),"granted"==Notification.permission&&e.pushManager.getSubscription().then(function(e){e&&a.setValue("on")}),new BroadcastChannel("notifications").onmessage=(e=>{var t=o.classList.contains("open");e.data.unseenNotifications&&(s.scrollTop=0,t?l():(i.innerHTML=e.data.unseenNotifications,i.classList.remove("up-to-date")))}))},o.addEventListener("click",e=>{e.target==o&&(o.classList.contains("open")?d():l())}),s.addEventListener("scroll",o=>{t||s.scrollTop==s.scrollHeight-s.offsetHeight&&(r.innerHTML="Loading...",ajax("/notifications/load",{page:++n},n=>{n.upToDate||!1===n.moreToLoad?(r.innerHTML="End of notifications",t=!0):r.innerHTML="&nbsp;",n.success&&(s.insertAdjacentHTML("beforeend",n.html),r.parentElement.appendChild(r),e||(t=!n.moreToLoad)&&(s.querySelector(".end").innerHTML="End of notifications"),e=n.latestNotification)}))}),document.addEventListener("click",e=>{o.classList.contains("open")&&e.target!=o&&e.target.closest(".notifications")!==o&&d()})}function c(e){e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(n),i=new Uint8Array(o.length);for(let e=0;e<o.length;++e)i[e]=o.charCodeAt(e);return i}("BDI1FRJJWq0lH-sFDeC54dedZlbxnPAmYIL4UoS9FSIrt21fvymYItofh0Lh7XIGCeyJ6GviNeiDsFhrJnV21uk")}).then(e=>{fetch("/notifications/subscribe",{method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),ga("send","event","push notifications enabled")})}function l(){o.classList.add("open");var n={};e&&(n.latestNotification=e),s.scrollTop=0,ajax("/notifications/load",n,n=>{n.upToDate&&(e||t||(t=!0,r.innerHTML="You don't have any notifications yet.")),n.success&&(s.insertAdjacentHTML("afterbegin",n.html),e||(t=!n.moreToLoad)&&(r.innerHTML="End of notifications"),e=n.latestNotification),(n.upToDate||n.success)&&i.classList.add("up-to-date")})}function d(){o.classList.remove("open"),s.querySelectorAll(".message-link.new").forEach(e=>{e.classList.remove("new")})}}(),navigator.serviceWorker.addEventListener("message",e=>{e.data.jumpToAnchor&&("loading"==document.readyState?document.addEventListener("readystatechange",e=>{"loading"!==document.readyState&&(window.location.hash=e.data.jumpToAnchor)}):window.location.hash=e.data.jumpToAnchor)}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{var t=document.querySelector("#user-bar .notifications");t&&t.init(e)})}),1!=window.devicePixelRatio&&document.body.dispatchEvent(new CustomEvent("devicePixelRatio")),document.addEventListener("click",function(e){if("path"==e.target.tagName)var t=e.target.parentElement.parentElement;else if("svg"==e.target.tagName)t=e.target.parentElement;else{if("A"!=e.target.tagName)return;t=e.target}if(t.classList.contains("outbound-link"))ga("send","event","Click Link Outbound",t.href,t.innerText);else if(t.classList.contains("outbound-social"))ga("send","event","Click Link Social",t.dataset.socialsite,window.location.pathname);else if(t.classList.contains("outbound-patreon"))ga("send","event","Click Link Patreon",t.dataset.loc,window.location.pathname);else if(t.classList.contains("promo-box"))ga("send","event","Click Promo",t.href,window.location.pathname);else if(t.dataset.clickevent){var n=t.dataset.clickevent.split("|");ga("send","event",n[0],n[1],n[2])}}),isInStandaloneMode){var mainMenu=document.querySelector("#main-menu"),cookieDate=new Date;cookieDate.setFullYear(3e3),cookieDate=cookieDate.toUTCString(),document.querySelector("#user-bar .standalone-menu .open-menu").addEventListener("click",e=>{mainMenu.classList.toggle("open"),document.querySelector("html").classList.toggle("standaloneMenuOpen");var t=mainMenu.classList.contains("open");"none"!==window.getComputedStyle(mainMenu).boxShadow&&(t=!1),document.cookie="standaloneMenuOpen="+t+"; expires="+cookieDate+"; path=/"}),document.querySelector("#main-menu .standalone-controls button.navigate-back").addEventListener("click",e=>{window.history.back()}),document.querySelector("#main-menu .standalone-controls button.navigate-back").addEventListener("click",e=>{window.history.forward()}),document.querySelector("#main-menu .standalone-controls button.navigate-refresh").addEventListener("click",e=>{location.reload()}),document.querySelector("#main-menu .standalone-controls button.navigate-share").addEventListener("click",e=>{document.querySelector(".popup.share-generic").show(e)}),document.addEventListener("click",function(e){mainMenu.classList.contains("open")&&(e.target.closest("#main-menu")||e.target.closest("button.open-menu")||"none"!=window.getComputedStyle(mainMenu).boxShadow&&(mainMenu.classList.remove("open"),document.querySelector("html").classList.remove("standaloneMenuOpen"),document.cookie="standaloneMenuOpen=false; expires="+cookieDate+"; path=/"))})}window.addEventListener("beforeunload",function(e){document.getElementById("page-loading-spinner").classList.add("visible")}),document.querySelector(".site-footer .patreon-counter .tip-box .show-more").addEventListener("click",e=>{e.preventDefault(),document.querySelector(".site-footer .patreon-counter .tip-box").classList.add("show-hidden")});